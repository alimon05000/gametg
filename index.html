<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0a1e15">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Намаз">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Точные времена намаза с утренними и вечерними азкарами">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;charset=utf-8;base64,ewogICJuYW1lIjogItCY0LfQvNC10YfQtdC90LjQtSDQstGC0L7QvNGD0YHQsCDQvdCw0LzQv9Cw0YAiLAogICJzaG9ydF9uYW1lIjogItCd0LDQvNCw0YAiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzA1MWExMiIsCiAgInRoZW1lX2NvbG9yIjogIiMwZDVlM2YiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2ltZy5pY29ucy5jb20vaWNvbnMyL2lzbGFtaWMvMjU2L3ByYXllci5wbmciLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9pbWcuaWNvbnMuY29tL2ljb25zMi9pc2xhbWljLzUxMi9wcmF5ZXIucG5nIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9CiAgXQp9">
    
    <title>Точные времена намаза</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Scheherazade+New&display=swap');
        
        :root {
            --primary-dark: #051a12;
            --primary-color: #0d5e3f;
            --secondary-color: #f0e6d2;
            --gold-color: #c9a769;
            --text-light: rgba(255, 255, 255, 0.95);
            --text-dark: #1a1a1a;
            --current-prayer-color: #4CAF50;
            --glass-bg: rgba(5, 26, 18, 0.18);
            --glass-border: rgba(201, 167, 105, 0.12);
            --glass-highlight: rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
            --card-bg: rgba(255, 255, 255, 0.1);
            --liquid-shine: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.05) 45%,
                rgba(255, 255, 255, 0) 55%,
                rgba(255, 255, 255, 0.03) 100%
            );
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            min-height: 100vh;
            font-family: 'Scheherazade New', serif;
            background: var(--primary-dark);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            perspective: 1000px;
        }
        
        .liquid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(13, 94, 63, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(201, 167, 105, 0.08) 0%, transparent 25%);
            z-index: 0;
            overflow: hidden;
        }
        
        .liquid-element {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(201, 167, 105, 0.08), transparent 70%);
            filter: blur(60px);
            opacity: 0.3;
            animation: float 15s infinite linear;
            z-index: -1;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, 30px) scale(1.1); }
            66% { transform: translate(-30px, 40px) scale(0.9); }
            100% { transform: translate(0, 0) scale(1); }
        }
        
        .container {
            position: relative;
            z-index: 10;
            width: 95%;
            max-width: 850px;
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: 24px;
            padding: 30px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            transform-style: preserve-3d;
            margin: 20px 0;
            overflow: hidden;
            transition: transform 0.5s ease, box-shadow 0.5s ease;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--liquid-shine);
            z-index: -1;
            pointer-events: none;
            animation: shine 8s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) skewX(-15deg); }
            100% { transform: translateX(100%) skewX(-15deg); }
        }
        
        h1 {
            font-family: 'Amiri', serif;
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            margin-bottom: 20px;
            color: var(--gold-color);
            text-shadow: 0 2px 10px rgba(201, 167, 105, 0.2);
            letter-spacing: 1px;
            position: relative;
            font-weight: 700;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 25%;
            width: 50%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-color), transparent);
            animation: titleGlow 3s infinite;
        }
        
        @keyframes titleGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
        
        .select-wrapper {
            position: relative;
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        select {
            width: 100%;
            padding: 14px 20px;
            font-size: 1rem;
            background: rgba(13, 94, 63, 0.25);
            border: 1px solid rgba(201, 167, 105, 0.25);
            border-radius: 12px;
            color: var(--text-light);
            cursor: pointer;
            appearance: none;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            font-family: 'Scheherazade New', serif;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }
        
        select:hover {
            background: rgba(13, 94, 63, 0.35);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .prayer-times {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin: 25px 0;
            perspective: 1000px;
        }
        
        .prayer-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid var(--glass-border);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 
                0 4px 30px rgba(0, 0, 0, 0.1),
                inset 0 0 16px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transform: translateZ(0);
            z-index: 1;
        }
        
        .prayer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--liquid-shine);
            z-index: -1;
            pointer-events: none;
            animation: shine 8s infinite;
            animation-delay: calc(var(--i) * 0.5s);
            opacity: 0.6;
            border-radius: inherit;
        }
        
        .prayer-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 1px solid transparent;
            border-radius: inherit;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0) 20%,
                rgba(255, 255, 255, 0) 80%,
                rgba(255, 255, 255, 0.1) 100%
            );
            pointer-events: none;
            mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            mask-composite: exclude;
            -webkit-mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            padding: 1px;
        }
        
        .prayer-card.current {
            background: linear-gradient(
                135deg,
                rgba(76, 175, 80, 0.2),
                rgba(13, 94, 63, 0.3)
            );
            border-color: rgba(76, 175, 80, 0.3);
            box-shadow: 
                0 0 25px rgba(76, 175, 80, 0.25),
                inset 0 0 16px rgba(76, 175, 80, 0.1);
            animation: pulseGlow 3s infinite alternate;
        }
        
        @keyframes pulseGlow {
            0% { 
                box-shadow: 
                    0 0 15px rgba(76, 175, 80, 0.25),
                    inset 0 0 16px rgba(76, 175, 80, 0.1);
            }
            100% { 
                box-shadow: 
                    0 0 30px rgba(76, 175, 80, 0.4),
                    inset 0 0 16px rgba(76, 175, 80, 0.2);
            }
        }
        
        .prayer-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--gold-color);
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }
        
        .prayer-time {
            font-size: 1.5rem;
            font-family: 'Amiri', serif;
            margin-bottom: 6px;
            position: relative;
            z-index: 2;
        }
        
        .time-remaining {
            font-size: 0.9rem;
            color: var(--gold-color);
            margin: 6px 0;
            font-family: 'Amiri', serif;
            position: relative;
            z-index: 2;
        }
        
        .additional-info {
            font-size: 0.8rem;
            color: var(--secondary-color);
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        .next-prayer-info {
            margin: 20px 0;
            padding: 16px;
            background: rgba(13, 94, 63, 0.25);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            font-size: 1rem;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .next-prayer-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--liquid-shine);
            z-index: -1;
            pointer-events: none;
            animation: shine 8s infinite;
            animation-delay: 0.3s;
            opacity: 0.6;
            border-radius: inherit;
        }
        
        .next-prayer-name {
            color: var(--gold-color);
            font-weight: bold;
        }
        
        .next-prayer-time {
            font-family: 'Amiri', serif;
            font-size: 1.2rem;
        }
        
        /* Улучшенный слайдер азкаров */
        .azkar-switcher {
            position: relative;
            margin: 30px auto;
            width: 90%;
            max-width: 400px;
            height: 60px;
            background: rgba(13, 94, 63, 0.2);
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.1),
                0 4px 30px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            user-select: none;
        }
        
        .azkar-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            color: var(--secondary-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .azkar-option.active {
            color: var(--gold-color);
        }
        
        .azkar-slider {
            position: absolute;
            top: 5px;
            height: calc(100% - 10px);
            background: linear-gradient(
                135deg,
                rgba(201, 167, 105, 0.3),
                rgba(201, 167, 105, 0.2)
            );
            border-radius: 25px;
            box-shadow: 
                0 4px 20px rgba(201, 167, 105, 0.2),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 1;
            backdrop-filter: blur(5px);
            overflow: hidden;
            will-change: transform;
            width: calc(33.333% - 10px);
            left: 5px;
        }
        
        .azkar-slider::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--liquid-shine);
            animation: shine 8s infinite;
            opacity: 0.5;
        }
        
        /* Контейнеры с азкарами */
        .azkar-container {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: rgba(5, 26, 18, 0.3);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .azkar-container.active {
            display: block;
        }
        
        .azkar-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--liquid-shine);
            z-index: -1;
            pointer-events: none;
            animation: shine 8s infinite;
            opacity: 0.3;
        }
        
        .azkar-item {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.1),
                inset 0 0 10px rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .azkar-item:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.15),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
        }
        
        .azkar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--liquid-shine);
            z-index: -1;
            pointer-events: none;
            animation: shine 8s infinite;
            opacity: 0.2;
        }
        
        .azkar-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: var(--text-light);
            margin-bottom: 10px;
            font-family: 'Amiri', serif;
            text-align: right;
            direction: rtl;
        }
        
        .azkar-translation {
            font-size: 1rem;
            color: var(--secondary-color);
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .azkar-reference {
            font-size: 0.8rem;
            color: var(--gold-color);
            font-style: italic;
        }
        
        .ayah-container {
            margin: 20px 0;
            position: relative;
            z-index: 2;
        }
        
        .ayah {
            font-size: 1.8rem;
            line-height: 1.6;
            color: var(--gold-color);
            font-family: 'Amiri', serif;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .ayah-translation {
            font-size: 1rem;
            margin-top: 12px;
            color: var(--secondary-color);
            opacity: 0.9;
        }
        
        .notify-btn {
            background: rgba(201, 167, 105, 0.15);
            color: var(--gold-color);
            border: 1px solid rgba(201, 167, 105, 0.3);
            padding: 14px 32px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.15),
                inset 0 0 12px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            font-weight: bold;
            z-index: 2;
        }
        
        .notify-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--liquid-shine);
            transition: 0.6s;
            z-index: -1;
        }
        
        .notify-btn:hover {
            background: rgba(201, 167, 105, 0.25);
            box-shadow: 
                0 6px 25px rgba(201, 167, 105, 0.2),
                inset 0 0 16px rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .notify-btn:hover::before {
            left: 100%;
        }

        .notify-btn.active {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.3);
            color: #fff;
        }
        
        .install-btn {
            background: linear-gradient(
                135deg,
                rgba(201, 167, 105, 0.8),
                rgba(201, 167, 105, 0.6)
            );
            color: var(--text-dark);
            border: none;
            padding: 12px 24px;
            font-size: 0.9rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px auto;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 
                0 4px 20px rgba(201, 167, 105, 0.3),
                inset 0 0 12px rgba(255, 255, 255, 0.2);
            font-weight: bold;
            position: relative;
            overflow: hidden;
            z-index: 2;
            display: none;
            animation: pulse 2s infinite;
        }
        
        .install-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--liquid-shine);
            transition: 0.6s;
            z-index: -1;
        }
        
        .install-btn:hover {
            box-shadow: 
                0 6px 25px rgba(201, 167, 105, 0.4),
                inset 0 0 16px rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .install-btn:hover::before {
            left: 100%;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Адаптация для маленьких экранов */
        @media (max-width: 480px) {
            .azkar-switcher {
                height: 50px;
            }
            
            .azkar-option {
                font-size: 0.9rem;
                padding: 8px 5px;
            }
            
            .prayer-times {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .notify-btn, .install-btn {
                padding: 12px 24px;
                font-size: 0.9rem;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                padding: 40px;
                border-radius: 28px;
            }
            
            .prayer-card {
                padding: 20px;
                border-radius: 20px;
            }
            
            .prayer-name {
                font-size: 1.2rem;
            }
            
            .prayer-time {
                font-size: 1.8rem;
            }
            
            .next-prayer-info {
                padding: 20px;
                border-radius: 20px;
            }
            
            .azkar-container {
                padding: 30px;
                border-radius: 25px;
            }
            
            .azkar-item {
                padding: 20px;
                border-radius: 18px;
            }
            
            .azkar-text {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="liquid-bg" id="liquid-bg"></div>
    
    <div class="container">
        <h1>Точные времена намаза</h1>
        
        <div class="select-wrapper">
            <select id="city-select">
                <option value="">Выберите город</option>
                <option value="moscow">Москва</option>
                <option value="saint-petersburg">Санкт-Петербург</option>
                <option value="kazan">Казань</option>
                <option value="ufa">Уфа</option>
                <option value="makhachkala">Махачкала</option>
                <option value="grozny">Грозный</option>
                <option value="novosibirsk">Новосибирск</option>
                <option value="krasnoyarsk">Красноярск</option>
                <option value="khasavyurt">Хасавюрт</option>
                <option value="belidzhi">Белиджи</option>
            </select>
        </div>
        
        <div class="prayer-times" id="prayer-times">
            <div class="prayer-card" data-prayer="fajr" style="--i:0">
                <div class="prayer-name">Фаджр</div>
                <div class="prayer-time" id="fajr-time">--:--</div>
                <div class="time-remaining" id="fajr-remaining"></div>
                <div class="additional-info">18° под горизонтом</div>
            </div>
            <div class="prayer-card" data-prayer="sunrise" style="--i:1">
                <div class="prayer-name">Восход</div>
                <div class="prayer-time" id="sunrise-time">--:--</div>
                <div class="time-remaining" id="sunrise-remaining"></div>
                <div class="additional-info">0° под горизонтом</div>
            </div>
            <div class="prayer-card" data-prayer="dhuhr" style="--i:2">
                <div class="prayer-name">Зухр</div>
                <div class="prayer-time" id="dhuhr-time">--:--</div>
                <div class="time-remaining" id="dhuhr-remaining"></div>
                <div class="additional-info">После зенита</div>
            </div>
            <div class="prayer-card" data-prayer="asr" style="--i:3">
                <div class="prayer-name">Аср</div>
                <div class="prayer-time" id="asr-time">--:--</div>
                <div class="time-remaining" id="asr-remaining"></div>
                <div class="additional-info">Тень = предмету</div>
            </div>
            <div class="prayer-card" data-prayer="maghrib" style="--i:4">
                <div class="prayer-name">Магриб</div>
                <div class="prayer-time" id="maghrib-time">--:--</div>
                <div class="time-remaining" id="maghrib-remaining"></div>
                <div class="additional-info">Солнце скрылось</div>
            </div>
            <div class="prayer-card" data-prayer="isha" style="--i:5">
                <div class="prayer-name">Иша</div>
                <div class="prayer-time" id="isha-time">--:--</div>
                <div class="time-remaining" id="isha-remaining"></div>
                <div class="additional-info">17° под горизонтом</div>
            </div>
        </div>
        
        <div class="next-prayer-info" id="next-prayer-info">
            До <span class="next-prayer-name" id="next-prayer-name">следующего намаза</span>: 
            <span class="next-prayer-time" id="next-prayer-time">--:--:--</span>
        </div>
        
        <!-- Переключатель азкаров -->
        <div class="azkar-switcher" id="azkar-switcher">
            <div class="azkar-slider" id="azkar-slider"></div>
            <div class="azkar-option active" data-target="morning">Утренние</div>
            <div class="azkar-option" data-target="evening">Вечерние</div>
            <div class="azkar-option" data-target="after-prayer">После намаза</div>
        </div>
        
        <!-- Контейнеры с азкарами -->
        <div class="azkar-container active" id="morning-azkar">
            <!-- Утренние азкары -->
            <div class="azkar-item">
                <div class="azkar-text">أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذَا الْيَوْمِ وَخَيْرَ مَا بَعْدَهُ، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذَا الْيَوْمِ وَشَرِّ مَا بَعْدَهُ، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ</div>
                <div class="azkar-translation">"Мы проснулись, и власть принадлежит Аллаху, и хвала Аллаху. Нет божества, кроме одного лишь Аллаха, у Которого нет сотоварища. Ему принадлежит власть, и Ему хвала, и Он над всякой вещью мощен. Господь, я прошу у Тебя блага этого дня и блага того, что после него, и прибегаю к Тебе от зла этого дня и зла того, что после него. Господь, я прибегаю к Тебе от лени и дряхлости в старости. Господь, я прибегаю к Тебе от мучений в Огне и мучений в могиле".</div>
                <div class="azkar-reference">Муслим 2723</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ</div>
                <div class="azkar-translation">"О Аллах, с Тобой мы встречаем утро, с Тобой встречаем вечер, с Тобой мы живём и с Тобой умираем, и к Тебе воскресение!"</div>
                <div class="azkar-reference">Ат-Тирмизи 3391</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</div>
                <div class="azkar-translation">"Пречист Аллах, и хвала Ему" (100 раз)</div>
                <div class="azkar-reference">Муслим 2691</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ</div>
                <div class="azkar-translation">"Нет божества, кроме одного лишь Аллаха, у Которого нет сотоварища. Ему принадлежит власть, и Ему хвала, и Он над всякой вещью мощен" (10 раз)</div>
                <div class="azkar-reference">Абу Дауд 5077</div>
            </div>
        </div>
        
        <div class="azkar-container" id="evening-azkar">
            <!-- Вечерние азкары -->
            <div class="azkar-item">
                <div class="azkar-text">أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذِهِ اللَّيْلَةِ وَخَيْرَ مَا بَعْدَهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذِهِ اللَّيْلَةِ وَشَرِّ مَا بَعْدَهَا، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ</div>
                <div class="azkar-translation">"Мы дожили до вечера, и власть принадлежит Аллаху, и хвала Аллаху. Нет божества, кроме одного лишь Аллаха, у Которого нет сотоварища. Ему принадлежит власть, и Ему хвала, и Он над всякой вещью мощен. Господь, я прошу у Тебя блага этой ночи и блага того, что после неё, и прибегаю к Тебе от зла этой ночи и зла того, что после неё. Господь, я прибегаю к Тебе от лени и дряхлости в старости. Господь, я прибегаю к Тебе от мучений в Огне и мучений в могиле".</div>
                <div class="azkar-reference">Муслим 2723</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ</div>
                <div class="azkar-translation">"О Аллах, с Тобой мы встречаем вечер, с Тобой встречаем утро, с Тобой мы живём и с Тобой умираем, и к Тебе воскресение!"</div>
                <div class="azkar-reference">Ат-Тирмизи 3391</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</div>
                <div class="azkar-translation">"Пречист Аллах, и хвала Ему" (100 раз)</div>
                <div class="azkar-reference">Муслим 2691</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">آمَنَ الرَّسُولُ بِمَا أُنْزِلَ إِلَيْهِ مِنْ رَبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ لَا نُفَرِّقُ بَيْنَ أَحَدٍ مِنْ رُسُلِهِ ۚ وَقَالُوا سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ الْمَصِيرُ</div>
                <div class="azkar-translation">"Посланник и верующие уверовали в то, что ниспослано ему от Господа. Все они уверовали в Аллаха, Его ангелов, Его Писания и Его посланников. Они говорят: "Мы не делаем различий между Его посланниками". Они говорят: "Слушаем и повинуемся! Твоего прощения, Господь наш, и к Тебе предстоит прибытие"".</div>
                <div class="azkar-reference">Коран 2:285</div>
            </div>
        </div>
        
        <div class="azkar-container" id="after-prayer-azkar">
            <!-- Азкары после намаза -->
            <div class="azkar-item">
                <div class="azkar-text">أَسْتَغْفِرُ اللَّهَ (3 مرات) اللَّهُمَّ أَنْتَ السَّلَامُ وَمِنْكَ السَّلَامُ تَبَارَكْتَ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ</div>
                <div class="azkar-translation">"Я прошу прощения у Аллаха" (3 раза). "О Аллах, Ты - Мир, и от Тебя - мир. Благословен Ты, о Обладатель величия и почета!"</div>
                <div class="azkar-reference">Муслим 591</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، اللَّهُمَّ لَا مَانِعَ لِمَا أَعْطَيْتَ، وَلَا مُعْطِيَ لِمَا مَنَعْتَ، وَلَا يَنْفَعُ ذَا الْجَدِّ مِنْكَ الْجَدُّ</div>
                <div class="azkar-translation">"Нет божества, кроме одного лишь Аллаха, у Которого нет сотоварища. Ему принадлежит власть, и Ему хвала, и Он над всякой вещью мощен. О Аллах, никто не лишит того, что Ты даровал, и никто не дарует того, чего Ты лишил, и не принесет пользы богатство обладателя богатства пред Тобой".</div>
                <div class="azkar-reference">Аль-Бухари 844</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">سُبْحَانَ اللَّهِ (33 مرة) ، الْحَمْدُ لِلَّهِ (33 مرة) ، اللَّهُ أَكْبَرُ (33 مرة)</div>
                <div class="azkar-translation">"Пречист Аллах" (33 раза), "Хвала Аллаху" (33 раза), "Аллах велик" (33 раза)</div>
                <div class="azkar-reference">Муслим 597</div>
            </div>
            
            <div class="azkar-item">
                <div class="azkar-text">لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ</div>
                <div class="azkar-translation">"Нет божества, кроме одного лишь Аллаха, у Которого нет сотоварища. Ему принадлежит власть, и Ему хвала, и Он над всякой вещью мощен" (10 раз после утреннего и послеполуденного намаза)</div>
                <div class="azkar-reference">Ахмад 4/227</div>
            </div>
        </div>
        
        <div class="ayah-container">
            <div class="ayah">إِنَّ ٱلصَّلَوٰةَ كَانَتْ عَلَى ٱلْمُؤْمِنِينَ كِتَـٰبًۭا مَّوْقُوتًۭا</div>
            <div class="ayah-translation">"Воистину, намаз предписан верующим в определённое время" (4:103)</div>
        </div>

        <button class="notify-btn" id="notify-btn">Уведомлять о намазе</button>
        
        <button class="install-btn" id="install-btn">Установить приложение</button>
    </div>

    <!-- Аудио для уведомлений (скрыто) -->
    <audio id="fajr-adhan" preload="auto">
        <source src="https://www.islamcan.com/audio/adhan/fajr.mp3" type="audio/mpeg">
    </audio>
    <audio id="adhan" preload="auto">
        <source src="https://www.islamcan.com/audio/adhan/standard.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Создаем жидкие элементы для фона
        const liquidBg = document.getElementById('liquid-bg');
        for (let i = 0; i < 5; i++) {
            const element = document.createElement('div');
            element.className = 'liquid-element';
            element.style.width = `${Math.random() * 300 + 100}px`;
            element.style.height = element.style.width;
            element.style.left = `${Math.random() * 100}%`;
            element.style.top = `${Math.random() * 100}%`;
            element.style.animationDelay = `${Math.random() * 10}s`;
            liquidBg.appendChild(element);
        }

        // API для получения времен намаза
        async function getPrayerTimes(city) {
            const date = new Date();
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            
            // Координаты городов (добавлены Хасавюрт и Белиджи)
            const cities = {
                'moscow': { lat: 55.7558, lng: 37.6176, method: 3 },
                'saint-petersburg': { lat: 59.9343, lng: 30.3351, method: 3 },
                'kazan': { lat: 55.7961, lng: 49.1064, method: 3 },
                'ufa': { lat: 54.7351, lng: 55.9587, method: 3 },
                'makhachkala': { lat: 42.9831, lng: 47.5047, method: 1 },
                'grozny': { lat: 43.3180, lng: 45.6982, method: 1 },
                'novosibirsk': { lat: 55.0084, lng: 82.9357, method: 3 },
                'krasnoyarsk': { lat: 56.0153, lng: 92.8932, method: 3 },
                'khasavyurt': { lat: 43.2509, lng: 46.5877, method: 1 }, // Хасавюрт
                'belidzhi': { lat: 42.1333, lng: 48.0667, method: 1 }    // Белиджи
            };
            
            const { lat, lng, method } = cities[city];
            
            try {
                // Используем метод 1 (MWL) для Дагестана и метод 3 (Russia) для остальных
                const response = await fetch(`https://api.aladhan.com/v1/timings/${day}-${month}-${year}?latitude=${lat}&longitude=${lng}&method=${method}&tune=0,0,0,0,0,0,0,0,0`);
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    return {
                        fajr: formatTime(data.data.timings.Fajr),
                        sunrise: formatTime(data.data.timings.Sunrise),
                        dhuhr: formatTime(data.data.timings.Dhuhr),
                        asr: formatTime(data.data.timings.Asr),
                        maghrib: formatTime(data.data.timings.Maghrib),
                        isha: formatTime(data.data.timings.Isha)
                    };
                }
            } catch (e) {
                console.error('Ошибка получения времен намаза:', e);
                return getFallbackTimes(city);
            }
            
            return getFallbackTimes(city);
        }

        // Форматирование времени
        function formatTime(timeStr) {
            return timeStr.split(' ')[0];
        }

        // Резервные времена намаза (добавлены Хасавюрт и Белиджи)
        function getFallbackTimes(city) {
            const times = {
                'moscow': {
                    fajr: '03:15',
                    sunrise: '05:30',
                    dhuhr: '12:30',
                    asr: '16:15',
                    maghrib: '20:15',
                    isha: '22:30'
                },
                'saint-petersburg': {
                    fajr: '03:45',
                    sunrise: '06:00',
                    dhuhr: '13:00',
                    asr: '16:45',
                    maghrib: '21:00',
                    isha: '23:15'
                },
                'kazan': {
                    fajr: '03:30',
                    sunrise: '05:45',
                    dhuhr: '12:45',
                    asr: '16:30',
                    maghrib: '20:30',
                    isha: '22:45'
                },
                'ufa': {
                    fajr: '04:00',
                    sunrise: '06:15',
                    dhuhr: '13:15',
                    asr: '17:00',
                    maghrib: '20:45',
                    isha: '23:00'
                },
                'makhachkala': {
                    fajr: '03:45',
                    sunrise: '05:30',
                    dhuhr: '12:15',
                    asr: '15:45',
                    maghrib: '19:30',
                    isha: '21:15'
                },
                'grozny': {
                    fajr: '03:30',
                    sunrise: '05:15',
                    dhuhr: '12:00',
                    asr: '15:30',
                    maghrib: '19:15',
                    isha: '21:00'
                },
                'novosibirsk': {
                    fajr: '04:30',
                    sunrise: '06:45',
                    dhuhr: '13:45',
                    asr: '17:30',
                    maghrib: '21:15',
                    isha: '23:30'
                },
                'krasnoyarsk': {
                    fajr: '04:15',
                    sunrise: '06:30',
                    dhuhr: '13:30',
                    asr: '17:15',
                    maghrib: '21:00',
                    isha: '23:15'
                },
                'khasavyurt': {
                    fajr: '03:20',
                    sunrise: '05:15',
                    dhuhr: '12:10',
                    asr: '15:40',
                    maghrib: '19:05',
                    isha: '20:50'
                },
                'belidzhi': {
                    fajr: '03:15',
                    sunrise: '05:10',
                    dhuhr: '12:05',
                    asr: '15:35',
                    maghrib: '19:00',
                    isha: '20:45'
                }
            };
            return times[city] || times['moscow'];
        }

        // Обновление времен намаза
        async function updatePrayerTimes(city) {
            // Сохраняем выбранный город в localStorage
            localStorage.setItem('selectedCity', city);
            
            const times = await getPrayerTimes(city);
            
            document.getElementById('fajr-time').textContent = times.fajr;
            document.getElementById('sunrise-time').textContent = times.sunrise;
            document.getElementById('dhuhr-time').textContent = times.dhuhr;
            document.getElementById('asr-time').textContent = times.asr;
            document.getElementById('maghrib-time').textContent = times.maghrib;
            document.getElementById('isha-time').textContent = times.isha;

            updateCurrentPrayer();
            if (Notification.permission === 'granted') {
                setupPrayerNotifications(city);
            }
        }

        // Определение текущего намаза
        function updateCurrentPrayer() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            let nextPrayer = null;
            let minDiff = Infinity;

            document.querySelectorAll('.prayer-card').forEach(card => {
                card.classList.remove('current');
                const timeStr = card.querySelector('.prayer-time').textContent;
                const [hours, minutes] = timeStr.split(':').map(Number);
                let prayerTime = hours * 60 + minutes;
                let diff = prayerTime - currentTime;

                if (diff < 0) diff += 1440;
                if (diff < minDiff) {
                    minDiff = diff;
                    nextPrayer = card;
                }

                if (Math.abs(prayerTime - currentTime) <= 5 || Math.abs(prayerTime + 1440 - currentTime) <= 5) {
                    card.classList.add('current');
                }
            });

            if (nextPrayer) {
                const name = nextPrayer.querySelector('.prayer-name').textContent;
                document.getElementById('next-prayer-name').textContent = name;
                
                const hours = Math.floor(minDiff / 60);
                const minutes = minDiff % 60;
                const seconds = 59 - now.getSeconds();
                
                document.getElementById('next-prayer-time').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Обновление каждую секунду
        function startPrayerTimeUpdates() {
            updateCurrentPrayer();
            setInterval(updateCurrentPrayer, 1000);
        }

        // Логика слайдера азкаров
        const azkarSwitcher = document.getElementById('azkar-switcher');
        const azkarOptions = document.querySelectorAll('.azkar-option');
        const azkarSlider = document.getElementById('azkar-slider');
        const azkarContainers = document.querySelectorAll('.azkar-container');
        
        let isDragging = false;
        let startPos = 0;
        let currentTranslate = 0;
        let prevTranslate = 0;
        let currentIndex = 0;
        let sliderWidth = azkarSwitcher.offsetWidth / 3;

        function initSlider() {
            sliderWidth = azkarSwitcher.offsetWidth / 3;
            azkarSlider.style.width = `${sliderWidth}px`;
            currentTranslate = currentIndex * sliderWidth;
            prevTranslate = currentTranslate;
            azkarSlider.style.transform = `translateX(${currentTranslate}px)`;
        }

        azkarSwitcher.addEventListener('mousedown', dragStart);
        azkarSwitcher.addEventListener('mousemove', drag);
        azkarSwitcher.addEventListener('mouseup', dragEnd);
        azkarSwitcher.addEventListener('mouseleave', dragEnd);

        azkarSwitcher.addEventListener('touchstart', touchStart);
        azkarSwitcher.addEventListener('touchmove', touchDrag);
        azkarSwitcher.addEventListener('touchend', dragEnd);

        azkarOptions.forEach((option, index) => {
            option.addEventListener('click', () => {
                if (!isDragging) {
                    currentIndex = index;
                    setPositionByIndex();
                }
            });
        });

        function getPositionX(event) {
            return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
        }

        function dragStart(event) {
            startPos = getPositionX(event);
            isDragging = true;
            azkarSwitcher.classList.add('dragging');
            requestAnimationFrame(animation);
        }

        function touchStart(event) {
            startPos = event.touches[0].clientX;
            dragStart(event);
        }

        function drag(event) {
            if (isDragging) {
                const currentPosition = getPositionX(event);
                currentTranslate = prevTranslate + currentPosition - startPos;
            }
        }

        function touchDrag(event) {
            const currentPosition = event.touches[0].clientX;
            currentTranslate = prevTranslate + currentPosition - startPos;
            drag(event);
        }

        function dragEnd() {
            isDragging = false;
            azkarSwitcher.classList.remove('dragging');
            
            const movedBy = currentTranslate - prevTranslate;
            if (movedBy > sliderWidth/3 && currentIndex > 0) {
                currentIndex -= 1;
            } else if (movedBy < -sliderWidth/3 && currentIndex < 2) {
                currentIndex += 1;
            }
            
            setPositionByIndex();
        }

        function animation() {
            if (isDragging) {
                setSliderPosition();
                requestAnimationFrame(animation);
            }
        }

        function setSliderPosition() {
            if (currentTranslate < 0) currentTranslate = 0;
            if (currentTranslate > sliderWidth * 2) currentTranslate = sliderWidth * 2;
            azkarSlider.style.transform = `translateX(${currentTranslate}px)`;
        }

        function setPositionByIndex() {
            currentTranslate = currentIndex * sliderWidth;
            prevTranslate = currentTranslate;
            azkarSlider.style.transition = 'transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1)';
            azkarSlider.style.transform = `translateX(${currentTranslate}px)`;
            updateActiveTab();
        }

        function updateActiveTab() {
            azkarOptions.forEach((option, index) => {
                option.classList.toggle('active', index === currentIndex);
            });
            
            const target = azkarOptions[currentIndex].getAttribute('data-target');
            azkarContainers.forEach(container => {
                container.classList.remove('active');
                if (container.id === `${target}-azkar`) {
                    container.classList.add('active');
                }
            });
        }

        // Проверка возможностей браузера
        function checkBrowserCapabilities() {
            if (!('serviceWorker' in navigator)) {
                console.warn('Service Worker не поддерживается');
                return false;
            }
            
            if (!('Notification' in window)) {
                console.warn('Уведомления не поддерживаются');
                return false;
            }
            
            if (!('periodicSync' in navigator.serviceWorker)) {
                console.warn('Фоновая синхронизация не поддерживается');
            }
            
            return true;
        }

        // PWA функционал
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        function checkPWAInstallable() {
            // Показываем кнопку установки только на поддерживаемых платформах
            if (window.matchMedia('(display-mode: standalone)').matches) {
                // Уже установлено
                installBtn.style.display = 'none';
                return;
            }
            
            // Для iOS показываем инструкцию вместо кнопки
            if (isIOS()) {
                installBtn.style.display = 'none';
                return;
            }
            
            // Для Android и других поддерживающих PWA платформ
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installBtn.style.display = 'block';
            });
        }

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });

        window.addEventListener('appinstalled', () => {
            installBtn.style.display = 'none';
        });

        // Уведомления с азаном
        const notifyBtn = document.getElementById('notify-btn');
        const fajrAdhan = document.getElementById('fajr-adhan');
        const standardAdhan = document.getElementById('adhan');
        
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }
        
        function showIOSNotificationAlert() {
            alert('Для работы уведомлений на iOS:\n1. Добавьте это приложение на главный экран\n2. Откройте его как standalone-приложение\n3. Включите уведомления в настройках Safari\n4. Нажмите "Уведомлять о намазе" снова');
        }
        
        async function setupPrayerNotifications(city) {
            if (!checkBrowserCapabilities()) return;
            
            if (Notification.permission === 'granted') {
                await schedulePrayerNotifications(city);
                
                // Регистрируем фоновую синхронизацию
                if ('serviceWorker' in navigator && 'periodicSync' in navigator.serviceWorker) {
                    try {
                        const reg = await navigator.serviceWorker.ready;
                        await reg.periodicSync.register('prayer-times', {
                            minInterval: 12 * 60 * 60 * 1000 // 12 часов
                        });
                        console.log('Фоновая синхронизация зарегистрирована');
                    } catch (e) {
                        console.log('Ошибка регистрации фоновой синхронизации:', e);
                    }
                }
            }
        }
        
        async function schedulePrayerNotifications(city) {
            // Очищаем все предыдущие уведомления
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.getRegistration();
                if (registration) {
                    registration.getNotifications().then(notifications => {
                        notifications.forEach(notification => notification.close());
                    });
                }
            }
            
            const times = await getPrayerTimes(city);
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            // Сохраняем времена намаза для использования в service worker
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.ready;
                registration.active.postMessage({
                    type: 'SET_PRAYER_TIMES',
                    times: times,
                    city: city
                });
            }
            
            for (const [prayer, time] of Object.entries(times)) {
                if (prayer === 'sunrise') continue; // Пропускаем восход
                
                const [hours, minutes] = time.split(':').map(Number);
                const prayerTime = hours * 60 + minutes;
                let diff = prayerTime - currentTime;
                
                // Если время намаза уже прошло сегодня, планируем на завтра
                if (diff < 0) diff += 1440;
                
                // Планируем уведомление за 5 минут до намаза
                const notificationTime = diff - 5;
                if (notificationTime > 0) {
                    setTimeout(() => {
                        showPrayerNotification(prayer);
                    }, notificationTime * 60000);
                }
            }
        }
        
        function showPrayerNotification(prayer) {
            // Воспроизводим соответствующий азан
            if (prayer === 'fajr') {
                fajrAdhan.play().catch(e => console.log('Не удалось воспроизвести азан фаджр:', e));
            } else {
                standardAdhan.play().catch(e => console.log('Не удалось воспроизвести стандартный азан:', e));
            }
            
            // Показываем уведомление через service worker
            if ('serviceWorker' in navigator && Notification.permission === 'granted') {
                navigator.serviceWorker.ready.then(reg => {
                    reg.showNotification('Время намаза', {
                        body: `Скоро время намаза ${getPrayerName(prayer)}`,
                        icon: 'https://img.icons8.com/ios/512/islamic/prayer.png',
                        vibrate: [200, 100, 200, 100, 200],
                        tag: `prayer-${prayer}`,
                        data: {
                            prayer: prayer
                        }
                    });
                });
            }
        }
        
        function getPrayerName(prayer) {
            const names = {
                'fajr': 'Фаджр',
                'dhuhr': 'Зухр',
                'asr': 'Аср',
                'maghrib': 'Магриб',
                'isha': 'Иша'
            };
            return names[prayer] || prayer;
        }
        
        async function handleNotificationPermission() {
            let permission = Notification.permission;
            
            if (permission === 'default') {
                permission = await Notification.requestPermission();
            }
            
            if (permission === 'granted') {
                const city = document.getElementById('city-select').value;
                if (city) {
                    await setupPrayerNotifications(city);
                    notifyBtn.textContent = 'Уведомления включены';
                    notifyBtn.classList.add('active');
                } else {
                    alert('Пожалуйста, сначала выберите город');
                }
            } else {
                alert('Для работы уведомлений необходимо разрешение. Пожалуйста, разрешите уведомления в настройках браузера.');
            }
        }

        notifyBtn.addEventListener('click', async () => {
            if (isIOS()) {
                if (window.navigator.standalone) {
                    await handleNotificationPermission();
                } else {
                    showIOSNotificationAlert();
                }
                return;
            }
            
            await handleNotificationPermission();
        });

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Восстанавливаем выбранный город сразу после загрузки DOM
            const citySelect = document.getElementById('city-select');
            const savedCity = localStorage.getItem('selectedCity');
            
            if (savedCity) {
                citySelect.value = savedCity;
                // Запускаем обновление времен намаза без ожидания полной загрузки страницы
                updatePrayerTimes(savedCity).then(() => {
                    startPrayerTimeUpdates();
                });
            }
            
            // Инициализируем слайдер
            initSlider();
            
            // Проверяем состояние уведомлений
            if (Notification.permission === 'granted') {
                const city = citySelect.value;
                if (city) {
                    setupPrayerNotifications(city);
                    notifyBtn.textContent = 'Уведомления включены';
                    notifyBtn.classList.add('active');
                }
            }
            
            // Проверяем PWA установку
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => {
                        console.log('ServiceWorker registration successful');
                        checkPWAInstallable();
                    })
                    .catch(err => console.log('ServiceWorker registration failed: ', err));
            }
        });

        // Обработчик изменения города
        document.getElementById('city-select').addEventListener('change', async function() {
            if (this.value) {
                await updatePrayerTimes(this.value);
                
                // Обновление в полночь
                const now = new Date();
                const midnight = new Date(
                    now.getFullYear(),
                    now.getMonth(),
                    now.getDate() + 1,
                    0, 0, 0
                );
                const timeToMidnight = midnight - now;
                
                setTimeout(() => {
                    updatePrayerTimes(this.value);
                    setInterval(() => updatePrayerTimes(this.value), 86400000);
                }, timeToMidnight);
            }
        });
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js').then(
                    function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    },
                    function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    }
                );
            });
        }
    </script>

    <!-- Service Worker Script (inline for demo purposes) -->
    <script id="sw-script" type="text/javascript">
        // Этот код будет использоваться для создания файла sw.js
        const CACHE_NAME = 'prayer-times-v1';
        const ASSETS_TO_CACHE = [
            '/',
            '/index.html',
            'https://img.icons8.com/ios/512/islamic/prayer.png'
        ];

        self.addEventListener('install', (event) => {
            event.waitUntil(
                caches.open(CACHE_NAME)
                    .then((cache) => cache.addAll(ASSETS_TO_CACHE))
                    .then(() => self.skipWaiting())
            );
        });

        self.addEventListener('activate', (event) => {
            event.waitUntil(self.clients.claim());
        });

        self.addEventListener('fetch', (event) => {
            event.respondWith(
                caches.match(event.request)
                    .then((response) => response || fetch(event.request))
            );
        });

        let prayerTimes = {};

        self.addEventListener('message', (event) => {
            if (event.data.type === 'SET_PRAYER_TIMES') {
                prayerTimes = {
                    times: event.data.times,
                    city: event.data.city
                };
                console.log('Prayer times saved in Service Worker');
            }
        });

        self.addEventListener('periodicsync', (event) => {
            if (event.tag === 'prayer-times') {
                event.waitUntil(checkPrayerTimes());
            }
        });

        function checkPrayerTimes() {
            if (!prayerTimes.times) return;
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            for (const [prayer, time] of Object.entries(prayerTimes.times)) {
                if (prayer === 'sunrise') continue;
                
                const [hours, minutes] = time.split(':').map(Number);
                const prayerTime = hours * 60 + minutes;
                let diff = prayerTime - currentTime;
                
                if (diff < 0) diff += 1440;
                
                if (diff <= 5) {
                    showNotification(prayer);
                }
            }
        }

        function showNotification(prayer) {
            const prayerNames = {
                'fajr': 'Фаджр',
                'dhuhr': 'Зухр',
                'asr': 'Аср',
                'maghrib': 'Магриб',
                'isha': 'Иша'
            };
            
            self.registration.showNotification('Время намаза', {
                body: `Наступило время намаза ${prayerNames[prayer]}`,
                icon: 'https://img.icons8.com/ios/512/islamic/prayer.png',
                vibrate: [200, 100, 200, 100, 200],
                tag: `prayer-${prayer}-${Date.now()}`,
                data: { prayer: prayer }
            });
        }

        self.addEventListener('notificationclick', (event) => {
            event.notification.close();
            event.waitUntil(
                clients.matchAll({ type: 'window' })
                    .then((clientList) => {
                        if (clients.openWindow) {
                            return clients.openWindow('/');
                        }
                    })
            );
        });
    </script>

    <script>
        // Создаем файл sw.js динамически
        document.addEventListener('DOMContentLoaded', function() {
            const swScriptContent = document.getElementById('sw-script').textContent;
            const blob = new Blob([swScriptContent], { type: 'text/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            // Обновляем регистрацию Service Worker с новым URL
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            }
        });
    </script>
</body>
</html>
